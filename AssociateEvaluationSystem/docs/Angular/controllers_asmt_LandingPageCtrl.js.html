<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/asmt/LandingPageCtrl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/asmt/LandingPageCtrl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class AES.asmtApp.landingPageCtrl
 */

asmt.controller("landingPageCtrl", function($scope, $http, $rootScope, $window, SITE_URL, API_URL) {
    var quizPage = "";
    $scope.testtaker = "Loading...";
    var QUIZ_REST_URL = "/aes/rest/landing/";
    $scope.landingScript = "";
    $scope.hideBox = true;
    $scope.myTime = "";

    //RICHARD: get global settings to see if user can review
    var settingsUrl = "/aes/admin/globalSettings"
    $scope.getSettings = function () {
        $scope.getSettingsUnsuccessful = false;
        $http({
            method: 'GET',
            url: settingsUrl
        }).success(function (data) {
            if (!data) {
                $scope.getSettingsUnsuccessful = true;
            } else {
                $scope.settings = {};
                $scope.settings.keys = [];
                data.forEach(function (s) {
                    $scope.settings[s.propertyId] = s;
                    $scope.settings.keys.push(s.propertyId);
                });
            }
        }).error(function () {
            $scope.getSettingsUnsuccessful = true;
        });
    }
    
    //RICHARD
    //If logging in after test is taken,
    //we check the review global settings
    //to determine if user can review test or not
    var checkGS = function () {
        var assessmentId = quizPage.substring(quizPage.search("=") + 1);

        $http({
            method: 'GET',
            url: "/aes/rest/" + assessmentId,
            headers: {'Content-Type': 'application/json'}
        })
            .then(function (response) {

                if ($scope.settings[1].propertyValue == "true") {
                    //get max time allowed from global settings
                    //add that to the time that the test was finished
                    //and compare that resultant time with the current time
                    //if the resultant time is later than now, allow the review
                    //else we send the user away
                    var finTS = response.data.assessment.finishedTimeStamp;
                    var GSTime = $scope.settings[2].propertyValue;
                    var ts = finTS + (60 * 60 * 1000 * GSTime);
                    var maxReviewTime = new Date(ts);
                    var nowTime = new Date();
                    //compare times
                    if (nowTime &lt; maxReviewTime) {
                        $window.location.href = '/aes/quizReview?asmt=' + assessmentId;
                    }
                    else {
                        $window.location.href = '/aes/expired';
                    }
                }
                else {
                    $window.location.href = '/aes/expired';
                }
            })
    }
   
    $scope.gotoQuiz = function(){
        window.location = quizPage;
    }
     
    var go = function(){
        var assessmentId = quizPage.substring(quizPage.search("=")+1);
        console.log(quizPage);

        $http({
            method: 'GET',
            url: QUIZ_REST_URL  + assessmentId,
            headers: {'Content-Type': 'application/json'}
        })
            .then(function(response) {
                console.log(response.data);
                // Check response for assessment availability
                console.log(response);
                if (response.data.msg === "allow"){
                    console.log("test");
                    $rootScope.protoTest = response.data.assessment;
                    $scope.testtaker = "Welcome " + response.data.firstName + " " + response.data.lastName;
                    $scope.landingScript = response.data.landingScript;
                    // Changes the button on the assessment landing page based on time
                    if (response.data.timestamp != null){
                        $scope.myTime = "Continue Assessment";
                    } else {
                        $scope.myTime = "Start Assessment";
                    }

                    $scope.hideBox = false;
                }else {
                    checkGS();
                }
            })
    }
    $scope.getSettings();
    $http.get(SITE_URL.BASE + API_URL.BASE + API_URL.AUTH)
        .then(function(response) {
            if (response.data.authenticated) {
                var authUser = {
                    username : response.data.principal.username,
                    authority: response.data.principal.authorities[0].authority
                }
                $scope.authUser = authUser;
                $scope.candidateEmail = authUser.username;
                $http.get(SITE_URL.BASE + API_URL.BASE + API_URL.CANDIDATE + $scope.candidateEmail + API_URL.LINK)
                    .then(function(response) {
                        console.log(response.data.urlAssessment);
                        quizPage = response.data.urlAssessment;
                        console.log(quizPage);
                        go();
                    })
            }
        });
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AES.adminApp.AdminDashboardCtrl.html">AdminDashboardCtrl</a></li><li><a href="AES.adminApp.ChooseAssessmentCtrl.html">ChooseAssessmentCtrl</a></li><li><a href="AES.adminApp.CreateAssessmentCtrl.html">CreateAssessmentCtrl</a></li><li><a href="AES.adminApp.EmployeeViewCtrl.html">EmployeeViewCtrl</a></li><li><a href="AES.adminApp.MenuCtrl.html">MenuCtrl</a></li><li><a href="AES.adminApp.parserCtrl.html">parserCtrl</a></li><li><a href="AES.adminApp.RegisterEmployeeCtrl.html">RegisterEmployeeCtrl</a></li><li><a href="AES.adminApp.SettingsViewCtrl.html">SettingsViewCtrl</a></li><li><a href="AES.adminApp.UpdateEmployeeCtrl.html">UpdateEmployeeCtrl</a></li><li><a href="AES.asmtApp.CountdownController.html">CountdownController</a></li><li><a href="AES.asmtApp.landingPageCtrl.html">landingPageCtrl</a></li><li><a href="AES.asmtApp.quizController.html">quizController</a></li><li><a href="AES.asmtApp.QuizNavController.html">QuizNavController</a></li><li><a href="AES.asmtApp.quizReviewController.html">quizReviewController</a></li><li><a href="AES.bankApp.CategoryCtrl.html">CategoryCtrl</a></li><li><a href="AES.bankApp.MasterCtrl.html">MasterCtrl</a></li><li><a href="AES.bankApp.MenuCtrl.html">MenuCtrl</a></li><li><a href="AES.bankApp.QuestionCtrl.html">QuestionCtrl</a></li><li><a href="AES.bankApp.TagCtrl.html">TagCtrl</a></li><li><a href="AES.userApp.CandidateCtrl.html">CandidateCtrl</a></li><li><a href="AES.userApp.LoginCtrl.html">LoginCtrl</a></li><li><a href="AES.userApp.menuCtrl.html">menuCtrl</a></li><li><a href="AES.userApp.recruiterDashboardCtrl.html">recruiterDashboardCtrl</a></li><li><a href="AES.userApp.UpdateEmployeeCtrl.html">UpdateEmployeeCtrl</a></li></ul><h3>Namespaces</h3><ul><li><a href="AES.adminApp.html">adminApp</a></li><li><a href="AES.asmtApp.html">asmtApp</a></li><li><a href="AES.bankApp.html">bankApp</a></li><li><a href="AES.userApp.html">userApp</a></li><li><a href="AES%250DCreated%2520by%2520Mehrab%2520on%25205_30_2017..html">AESCreated by Mehrab on 5/30/2017.</a></li><li><a href="attr.ngfAsBackground.html">ngfAsBackground</a></li><li><a href="attr.ngfBackground.html">ngfBackground</a></li><li><a href="attr.ngfCapture.html">ngfCapture</a></li><li><a href="attr.ngfChange.html">ngfChange</a></li><li><a href="attr.ngfKeep.html">ngfKeep</a></li><li><a href="attr.ngfModelOptions.html">ngfModelOptions</a></li><li><a href="attr.ngfMultiple.html">ngfMultiple</a></li><li><a href="attr.ngfNoObjectUrl.html">ngfNoObjectUrl</a></li><li><a href="attr.ngfSelect.html">ngfSelect</a></li><li><a href="attr.ngfSize.html">ngfSize</a></li><li><a href="attr.ngfSrc.html">ngfSrc</a></li><li><a href="attr.ngfThumbnail.html">ngfThumbnail</a></li><li><a href="attr.ngfValidate.html">ngfValidate</a></li><li><a href="attr.ngModel.html">ngModel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$get">$get</a></li><li><a href="global.html#adjustTop">adjustTop</a></li><li><a href="global.html#calculatePosition">calculatePosition</a></li><li><a href="global.html#dragItem">dragItem</a></li><li><a href="global.html#eventObj">eventObj</a></li><li><a href="global.html#getRawNode">getRawNode</a></li><li><a href="global.html#height">height</a></li><li><a href="global.html#isScrollable">isScrollable</a></li><li><a href="global.html#isTouchInvalid">isTouchInvalid</a></li><li><a href="global.html#movePosition">movePosition</a></li><li><a href="global.html#noDrag">noDrag</a></li><li><a href="global.html#offset">offset</a></li><li><a href="global.html#offsetParent">offsetParent</a></li><li><a href="global.html#options">options</a></li><li><a href="global.html#parsePlacement">parsePlacement</a></li><li><a href="global.html#parseStyle">parseStyle</a></li><li><a href="global.html#position">position</a></li><li><a href="global.html#positionArrow">positionArrow</a></li><li><a href="global.html#positionElements">positionElements</a></li><li><a href="global.html#positionStarted">positionStarted</a></li><li><a href="global.html#scrollbarPadding">scrollbarPadding</a></li><li><a href="global.html#scrollbarWidth">scrollbarWidth</a></li><li><a href="global.html#scrollParent">scrollParent</a></li><li><a href="global.html#setTriggers">setTriggers</a></li><li><a href="global.html#viewportOffset">viewportOffset</a></li><li><a href="global.html#width">width</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue May 30 2017 10:36:13 GMT-0400 (DST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
