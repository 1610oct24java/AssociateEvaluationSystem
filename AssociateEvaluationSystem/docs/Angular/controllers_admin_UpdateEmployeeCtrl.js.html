<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers/admin/UpdateEmployeeCtrl.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers/admin/UpdateEmployeeCtrl.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @class AES.adminApp.UpdateEmployeeCtrl
 */

adminApp.controller('UpdateEmployeeCtrl', function($scope,$location,$http,$routeParams, SITE_URL, API_URL) {
    // list of candidates recruiter does not have.
    $scope.possibleCandidates = [];

    //list of candidates a recruiter does have.
    $scope.candidateList = [];



    $http.get(SITE_URL.BASE + API_URL.BASE + API_URL.AUTH)
        .then(function(response) {
            if (response.data.authenticated) {
                var authUser = {
                    username : response.data.principal.username,
                    authority: response.data.principal.authorities[0].authority
                };
                $scope.authUser = authUser;
                var role = $scope.authUser.authority;

                if(role == "ROLE_ADMIN") {
                    // Continue to page
                }else {
                    window.location = SITE_URL.LOGIN; // Deny page, re-route to login
                }
            } else {
                window.location = SITE_URL.LOGIN;
            }

        });

    //loads up fields with existing data
    var userEmail = $location.search().email;
    if (userEmail){
        var getInfo = SITE_URL.BASE + API_URL.BASE + API_URL.ADMIN + API_URL.EMPLOYEE + "/" + userEmail;
        $http.get(getInfo).then(function(response){
            var employee = response.data;
            $('#currentEmail').prop('readonly',true);
            $scope.oldEmail = employee.email;
            $scope.firstName = employee.firstName;
            $scope.lastName = employee.lastName;
            $scope.roleName = employee.role.roleTitle;
            $scope.userId = employee.userId;
            //get candidate list, if user role is recruiter
            if ($scope.roleName === "recruiter"){
                var getCandidateInfo = SITE_URL.BASE + API_URL.BASE + API_URL.ADMIN + API_URL.EMPLOYEE + "/" + userEmail + "/getCandidates";
                $http.get(getCandidateInfo).then(function(response){
                    $scope.candidateList = response.data;


                    // loads a full candidate list and then starts the function to generate the list for the add candidate
                    var getCandidateListInfo = SITE_URL.BASE + API_URL.BASE + API_URL.ADMIN + "/candidates"
                    $http.get(getCandidateListInfo).then(function(response){
                        $scope.allCandidates = response.data;
                        $scope.updatePossibleCandidatesList()
                    })

                });
            }
        });


    }


    //creates and updates the list of possible candidates to add
    $scope.updatePossibleCandidatesList = function(){
        $scope.possibleCandidates = [];
        $scope.allCandidates.forEach(function(candidate){
            if (candidate.recruiterId !== $scope.userId){
                $scope.possibleCandidates.push(candidate);
            }
        });

    }

    var move = function(objectToMove, fromArray, toArray){
        var i = fromArray.indexOf(objectToMove);
        var o = fromArray.splice(i, 1)[0];
        toArray.push(o);
    }

    $scope.toRight = function(){
        if ($scope.selectedCurrentCanidates != null){
            $scope.selectedCurrentCanidates.forEach(function(el){
                move(el, $scope.candidateList, $scope.possibleCandidates);
            });
        }
    }

    $scope.toLeft = function(){
        if ($scope.selectedNewCanidates != null){
            $scope.selectedNewCanidates.forEach(function(el){
                move(el, $scope.possibleCandidates, $scope.candidateList);
            });
        }
    }






    //$http.get(SITE_URL.BASE + API_URL.BASE + API_URL.ADMIN + API_URL.EMPLOYEE + "/" + )

    $scope.update= function() {
        $scope.passNotMatch = false;
        $scope.passNotEntered = false;
        $scope.emailNotEntered = false;
        $scope.userNotFound = false;


        var employeeInfo = {
            oldEmail		: $scope.oldEmail,
            newEmail      	: $scope.newEmail,
            firstName     	: $scope.firstName,
            lastName      	: $scope.lastName,
            oldPassword   	: $scope.oldPassword,
            newPassword   	: $scope.newPassword,
            candidates		: $scope.candidateList
        };

        //resets the error messages
        $scope.emailNotEntered = false;
        $scope.passNotMatch = false;
        $scope.emailNotEntered = false;
        $scope.updateSuccessful = false;
        $scope.updateUnsuccessful = false;


        if ($scope.oldEmail === "" || $scope.oldEmail == null)
        {	$scope.emailNotEntered = true; }

        if ($scope.newPassword !== $scope.confirmNewPassword)
        {
            $scope.passNotMatch = true;
            $scope.newPassword = '';
            $scope.confirmNewPassword = '';
        }

        if (!$scope.passNotMatch&amp;&amp; !$scope.passNotEntered
            &amp;&amp; !$scope.emailNotEntered)
        {
            $scope.postUpdate($scope.oldEmail, employeeInfo);
        }
    }

    $scope.postUpdate = function(oldEmail, updateInfo) {
        $scope.updateUnsuccessful = false;
        $scope.updateSuccessful = false;

        var updateUrl = SITE_URL.BASE + API_URL.BASE + API_URL.ADMIN
            + API_URL.EMPLOYEE + "/" + $scope.oldEmail + "/update";

        $http({
            method  : 'PUT',
            url		: updateUrl,
            headers : {'Content-Type' : 'application/json'},
            data    : updateInfo
        }).success(function(data){
            if (!data){
                $scope.updateUnsuccessful = true;
            } else {
                if($scope.newEmail){
                    $scope.oldEmail = $scope.newEmail;
                    $scope.newEmail = "";
                }

                $scope.confirmNewPassword = "";
                $scope.newPassword = "";

                $scope.updateSuccessful = true;
            }
        }).error( function() {
            $scope.updateUnsuccessful = true;
        });
    }

    $scope.logout = function() {
        $http.post(SITE_URL.BASE + API_URL.BASE + API_URL.LOGOUT)
            .then(function() {
                window.location = SITE_URL.LOGIN;
            });
    }

}); //end update credentials controller</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="AES.adminApp.AdminDashboardCtrl.html">AdminDashboardCtrl</a></li><li><a href="AES.adminApp.ChooseAssessmentCtrl.html">ChooseAssessmentCtrl</a></li><li><a href="AES.adminApp.CreateAssessmentCtrl.html">CreateAssessmentCtrl</a></li><li><a href="AES.adminApp.EmployeeViewCtrl.html">EmployeeViewCtrl</a></li><li><a href="AES.adminApp.MenuCtrl.html">MenuCtrl</a></li><li><a href="AES.adminApp.parserCtrl.html">parserCtrl</a></li><li><a href="AES.adminApp.RegisterEmployeeCtrl.html">RegisterEmployeeCtrl</a></li><li><a href="AES.adminApp.SettingsViewCtrl.html">SettingsViewCtrl</a></li><li><a href="AES.adminApp.UpdateEmployeeCtrl.html">UpdateEmployeeCtrl</a></li><li><a href="AES.asmtApp.CountdownController.html">CountdownController</a></li><li><a href="AES.asmtApp.landingPageCtrl.html">landingPageCtrl</a></li><li><a href="AES.asmtApp.quizController.html">quizController</a></li><li><a href="AES.asmtApp.QuizNavController.html">QuizNavController</a></li><li><a href="AES.asmtApp.quizReviewController.html">quizReviewController</a></li><li><a href="AES.bankApp.CategoryCtrl.html">CategoryCtrl</a></li><li><a href="AES.bankApp.MasterCtrl.html">MasterCtrl</a></li><li><a href="AES.bankApp.MenuCtrl.html">MenuCtrl</a></li><li><a href="AES.bankApp.QuestionCtrl.html">QuestionCtrl</a></li><li><a href="AES.bankApp.TagCtrl.html">TagCtrl</a></li><li><a href="AES.userApp.CandidateCtrl.html">CandidateCtrl</a></li><li><a href="AES.userApp.LoginCtrl.html">LoginCtrl</a></li><li><a href="AES.userApp.menuCtrl.html">menuCtrl</a></li><li><a href="AES.userApp.recruiterDashboardCtrl.html">recruiterDashboardCtrl</a></li><li><a href="AES.userApp.UpdateEmployeeCtrl.html">UpdateEmployeeCtrl</a></li></ul><h3>Namespaces</h3><ul><li><a href="AES.adminApp.html">adminApp</a></li><li><a href="AES.asmtApp.html">asmtApp</a></li><li><a href="AES.bankApp.html">bankApp</a></li><li><a href="AES.userApp.html">userApp</a></li><li><a href="AES%250DCreated%2520by%2520Mehrab%2520on%25205_30_2017..html">AESCreated by Mehrab on 5/30/2017.</a></li><li><a href="attr.ngfAsBackground.html">ngfAsBackground</a></li><li><a href="attr.ngfBackground.html">ngfBackground</a></li><li><a href="attr.ngfCapture.html">ngfCapture</a></li><li><a href="attr.ngfChange.html">ngfChange</a></li><li><a href="attr.ngfKeep.html">ngfKeep</a></li><li><a href="attr.ngfModelOptions.html">ngfModelOptions</a></li><li><a href="attr.ngfMultiple.html">ngfMultiple</a></li><li><a href="attr.ngfNoObjectUrl.html">ngfNoObjectUrl</a></li><li><a href="attr.ngfSelect.html">ngfSelect</a></li><li><a href="attr.ngfSize.html">ngfSize</a></li><li><a href="attr.ngfSrc.html">ngfSrc</a></li><li><a href="attr.ngfThumbnail.html">ngfThumbnail</a></li><li><a href="attr.ngfValidate.html">ngfValidate</a></li><li><a href="attr.ngModel.html">ngModel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#$get">$get</a></li><li><a href="global.html#adjustTop">adjustTop</a></li><li><a href="global.html#calculatePosition">calculatePosition</a></li><li><a href="global.html#dragItem">dragItem</a></li><li><a href="global.html#eventObj">eventObj</a></li><li><a href="global.html#getRawNode">getRawNode</a></li><li><a href="global.html#height">height</a></li><li><a href="global.html#isScrollable">isScrollable</a></li><li><a href="global.html#isTouchInvalid">isTouchInvalid</a></li><li><a href="global.html#movePosition">movePosition</a></li><li><a href="global.html#noDrag">noDrag</a></li><li><a href="global.html#offset">offset</a></li><li><a href="global.html#offsetParent">offsetParent</a></li><li><a href="global.html#options">options</a></li><li><a href="global.html#parsePlacement">parsePlacement</a></li><li><a href="global.html#parseStyle">parseStyle</a></li><li><a href="global.html#position">position</a></li><li><a href="global.html#positionArrow">positionArrow</a></li><li><a href="global.html#positionElements">positionElements</a></li><li><a href="global.html#positionStarted">positionStarted</a></li><li><a href="global.html#scrollbarPadding">scrollbarPadding</a></li><li><a href="global.html#scrollbarWidth">scrollbarWidth</a></li><li><a href="global.html#scrollParent">scrollParent</a></li><li><a href="global.html#setTriggers">setTriggers</a></li><li><a href="global.html#viewportOffset">viewportOffset</a></li><li><a href="global.html#width">width</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Tue May 30 2017 10:36:13 GMT-0400 (DST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
